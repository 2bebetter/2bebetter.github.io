---
layout: post
title:  "修改ubuntu18的DNS配置"
date:   2021-04-09 10:21:40 +0800
typora-root-url: ..
categories: ubuntu
---

* content
{:toc}

# 修改ubuntu18的网络配置

本来以为是很简单的一个配置过程，但是因为DNS配置一直不能生效，所以还是耽误了很长时间，简单记录一下这个过程。

1. 配置网卡地址

编辑/etc/network/interfaces文件：

```bash
auto eno1
iface eno1 inet static
        address 192.168.xxx
        gateway 192.168.228.1
        netmask 255.255.255.0
        dns-nameserver 8.8.8.8
        dns-nameserver 114.114.114.114
```

sudo service networking restart 重启网络服务。

2. 配置DNS

上述步骤配置了DNS后，查看/etc/resolv.conf发现配置并未生效：

```bash
nameserver 127.0.0.53
options edns0
```

找了几个网络上提供的方式：

（1） 修改/etc/resolvconf/resolv.conf.d/base

手动修改/etc/resolv.conf，添加你想要使用的dns-server(这一步仅仅是临时的)，sudo apt-get install resolvconf安装resolvconf，之后修改/etc/resolvconf/resolv.conf.d/base文件：

```bash
nameserver 8.8.8.8
nameserver 114.114.114.114
```

sudo resolvconf -u或者sudo service resolvconf restart重启服务

查看/etc/resolv.conf发现配置失败

(2) 通过/etc/network/interfaces配置

编辑/etc/network/interfaces文件：

```bash
auto eno1
iface eno1 inet static
        address 192.168.xxx
        gateway 192.168.228.1
        netmask 255.255.255.0
        dns-nameserver 8.8.8.8
        dns-nameserver 114.114.114.114
```

重启网络服务后发现配置还是失败。

**（3）修改/etc/systemd/resolved.conf**

最终只能观察/etc/resolv.conf文件，发现文件头标明：

```bash
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
# 127.0.0.53 is the systemd-resolved stub resolver.
# run "systemd-resolve --status" to see details about the actual nameservers.
```

于是去修改/etc/systemd文件夹下的resolved.conf文件：

```bash
#  This file is part of systemd.
#
#  systemd is free software; you can redistribute it and/or modify it
#  under the terms of the GNU Lesser General Public License as published by
#  the Free Software Foundation; either version 2.1 of the License, or
#  (at your option) any later version.
#
# Entries in this file show the compile time defaults.
# You can change settings by editing this file.
# Defaults can be restored by simply deleting this file.
#
# See resolved.conf(5) for details

[Resolve]
DNS=8.8.8.8 114.114.114.114
#FallbackDNS=
#Domains=
#LLMNR=no
#MulticastDNS=no
#DNSSEC=no
#Cache=yes
#DNSStubListener=yes
```

重启networking、resolvconf服务后查看/etc/resolv.conf:

```bash
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
# 127.0.0.53 is the systemd-resolved stub resolver.
# run "systemd-resolve --status" to see details about the actual nameservers.

nameserver 8.8.8.8
nameserver 114.114.114.114
nameserver 127.0.0.53
options edns0
```

配置成功。

